@model DocumentManagementSystem.Models.DocumentVerificationModel


@{
    Layout = null;
}


<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>BOZOK BYS</title>
    <link rel="icon" href="~/image/site/BozokIcon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.5.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
    <link href="~/Content/pricing.css" rel="stylesheet" />


    <script src="https://www.google.com/recaptcha/api.js"></script>
</head>

<body>

    <!--Navbar-->
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow sticky-top ">

        <h5 class="my-0 mr-md-auto font-weight-normal">
            <img class="my-0 mr-md-auto font-weight-normal" src="~/image/site/BozokIcon.png" width="45" height="45" />
            BOZOK BYS
        </h5>

        <nav class="my-2 my-md-0 mr-md-3 ">
            <a class="p-2 text-dark  " href="@Url.Action("Home" , "Home")">Belge Doğrulama</a>
        </nav>
        <a class="btn btn-outline-primary" href="@Url.Action("SignIn" , "Home")">Giriş Yap</a>
    </div>
    <!--Navbar-->
    <!--Body-->
    <div class="pricing-header px-3   pb-md-4 mx-auto text-center">
        <h1 class="display-">Belge Doğrulama</h1>
    </div>

    <!--Form İşlemleri-->
    <div class="d-flex align-items-center justify-content-center ">
        <div class="form-label-group ">
            @using (Html.BeginForm("Home", "Home", FormMethod.Post, new { onsubmit = "return codeValidate();" }))
            {

                @Html.TextBoxFor(x => x.VerificationCode, new { id = "myInput", oninput = "convertToUpperCase()", placeholder = "Belge Kodunu Giriniz", @class = "form-control" })
                <p class="text-danger m" id="inputError"></p>

                <div class="g-recaptcha" data-sitekey="6LeTsZslAAAAAIKJenK0ZP832i_B2TIAZjHbiTVL"></div>
                <p class="text-danger m" id="captchaError"></p>


                <button class="btn mt-3 btn-primary btn-block" onclick="codeValidate()">Sorgula</button>

            }
        </div>
    </div>
    <!--Form İşlemleri-->
    <!--Sorgulama Sonucu-->


    @if (Model.isPostMethod)  //true ise post edilmiş demektir
    {
        if (Model.captchaStatus)
        {

            if (Model.document != null)
            {
                if (!Model.document.DocumentStatus) //false
                {
                    <!--Olumsuz-->
                    <div class="container pt-4">
                        <div class="row">
                            <div class="col-md-6 offset-md-3">
                                <div class="alert alert-danger text-center">
                                    <h5>Böyle bir belge bulunamadı ! <i class="bi bi-x-lg"></i></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Olumsuz-->

                }
                else //true
                {
                    <!--Olumlu-->
                    <div class="container pt-4">
                        <div class="row">
                            <div class="col-md-6 offset-md-3">
                                <div class="alert alert-success text-center">
                                    <h5>Doğrulanmış Belge <i class="bi bi-check2-all "></i></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container col-md-10 offset-md-3">
                        <div class="col-md-10 row ">
                            <div class="col-md-5">
                                <ul class="list-group list-group-flush text-center">
                                    <li class="list-group-item font-weight-bold">Belge Adı :</li>
                                    <li class="list-group-item font-weight-bold">Belge Sahibi :</li>
                                    <li class="list-group-item font-weight-bold">Veriliş Tarihi :</li>
                                </ul>
                            </div>
                            <div class="col-md-5">
                                <ul class="list-group list-group-flush text-center ">
                                    <li class="list-group-item ">@Model.document.DocumentType.DocumentTypeName</li>
                                    <li class="list-group-item">@Model.document.Student.StudentName @Model.document.Student.StudentSurname</li>
                                    <li class="list-group-item">@Model.document.DocumentCreateDate.ToString("g")</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!--Olumlu-->
                }


            }
            else //null
            {
                <!--Olumsuz-->
                <div class="container pt-4">
                    <div class="row">
                        <div class="col-md-6 offset-md-3">
                            <div class="alert alert-danger text-center">
                                <h5>Böyle bir belge bulunamadı ! <i class="bi bi-x-lg"></i></h5>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Olumsuz-->

            }
        }
        else
        {
            <!--Olumsuz-->
            <div class="container pt-4">
                <div class="row">
                    <div class="col-md-6 offset-md-3">
                        <div class="alert alert-danger text-center">
                            <h5>Lütfen Captcha doğrulamasını yapınız ! <i class="bi bi-x-lg"></i></h5>
                        </div>
                    </div>
                </div>
            </div>
            <!--Olumsuz-->
        }
    }





    <!--Sorgulama Sonucu-->
    <!--Body-->
    <!--Footer-->
    <div class="container pt-md-5">
        <footer class="pt-4 my-md-5 pt-md-5 border-top">
            <div class="row">
                <div class="col-12 col-md">
                    <img class="mb-2" src="~/image/site/BozokIcon.png" alt="" width="24" height="24">
                    <small class="d-block mb-3 text-muted">&copy; 2022-2023</small>
                </div>
                <div class="col-6 col-md">
                    <h5>Hızlı Linkler</h5>
                    <ul class="list-unstyled text-small">
                        <li><a class="text-muted" href="@Url.Action("Home" , "Home")">Belge Doğrulama</a></li>
                        <li><a class="text-muted" href="@Url.Action("SignIn" , "Home")">Giriş Yap</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md">
                    <h5>Yardımcı Linkler</h5>
                    <ul class="list-unstyled text-small">
                        <li><a class="text-muted" href="https://bozok.edu.tr/">Bozok Ana Site</a></li>
                        <li><a class="text-muted" href="https://boysis.bozok.edu.tr/kullanici/giris-yap">Boysis</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md">
                    <h5>Destek</h5>
                    <ul class="list-unstyled text-small">
                        <li><a class="text-muted" href="http://yenibilgi.bozok.edu.tr/">Bilgi İşlem</a></li>

                    </ul>
                </div>
            </div>
        </footer>
    </div>
    <!--Footer-->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script>
        function convertToUpperCase() {
            var input = document.getElementById("myInput");
            input.value = input.value.toUpperCase(); // Metni büyük harfe çevir

            //TODO : her 4 karakterde bir - eklesin
        }

        function codeValidate() {
            var code = document.getElementById("myInput").value;

            var inputError = document.getElementById("inputError");
            var inputErrorMessage = "";
            var returnVelue = true;

            if (code.length <= 0) {
                inputErrorMessage = "Lütfen belge kodunu giriniz !";
                returnVelue = false;
            }
            else if (code.length < 12 || code.length > 12) {
                inputErrorMessage = "Belge kodu 12 karakterdir !";
                returnVelue = false;
            }

            var captchaError = document.getElementById("captchaError");
            var captchaErrorMessage = "";

            var captcharesult = grecaptcha.getResponse();

            if (captcharesult.length == 0) {
                captchaErrorMessage = "Lütfen Captcha doğrulamasını yapınız !";
                returnVelue = false;
            }

            inputError.textContent = inputErrorMessage;
            captchaError.textContent = captchaErrorMessage;
            return returnVelue;
        }

    </script>
</body>
</html>
